<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/localbase@0.7.5/dist/localbase.min.js"></script>

    <title>Série</title>
</head>
<body class="container">

    <style>
        #select_treino{
            margin-top: 20px;
            margin-bottom: 20px;
        }

        td{
            padding: 10px;
        }

        .opaco{
            padding: 5px;
            margin-bottom: 5px;
            border-radius: 5px;
            margin-left: -5px;
        }

        #select_treino{
            padding-right: 200px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
        }

        .select_topo{
            align-tracks: center;
            padding-left: 10px;
            padding-top: 10px;
            margin-top: 5px;
            margin-bottom: 5px;
            margin-left: -5px;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 5px;
        }

        .hidden{
            display: none;
        }

        .hide{
            display: none;
        }
    </style>

    <div class="select_topo">
        <h3>Programa de Treinos</h3>
        Treino: <select id="select_treino" onchange="change(this)">
            <option value="0">Todos</option>
            <option value="1">Inferiores</option>
            <option value="2">Biceps</option>
            <option value="3">Triceps</option>
        </select>
    </div>
    
    
    <div class="opaco">
        <div class="pernas">
            <table id="treino_1" class="table table-striped">
            </table>
        </div>
    </div>


    <input type="button" value="Add Exercício" id="ativarAdd"></p></p>
    <div id="escondida" style="display: none;">
        <table>
            <tr><td>Exercicio</td><td><input type="text" name="nomeEx" id="nomeEx"></td></tr>
            <tr><td>Serie</td><td><input type="text" name="linkImg" id="serieEx"></td></tr>
            <tr><td>Repetições</td><td><input type="text" name="repeticoesEx" id="repeticoesEx"></td></tr>
            <tr><td>Carga</td><td><input type="text" name="cargaEx" id="cargaEx"></td></tr>
            <tr><td>Descanso</td><td><input type="text" name="descansoEx" id="descansoEx"></td></tr>
            <tr><td>Metodo</td><td><input type="text" name="metodoEx" id="metodoEx"></td></tr>
            <tr><td>Imagem</td><td><input type="text" name="imagemEx" id="imagemEx"></td></tr>
            <tr><td>Vídeo</td><td><input type="text" name="videoEx" id="videoEx"></td></tr>
            <tr>
                <td>Tipo</td><td><input type="radio" name="tipoEx" id="tipoEx" value="0">Inferiores
                <input type="radio" name="tipoEx" id="tipoEx" value="1">Biceps
                <input type="radio" name="tipoEx" id="tipoEx" value="2">Triceps</td>
            </tr>

            <tr>
                <td>
                    <button id="addEx">add</button>
                </td>
            </tr>
        </table>
    </div>

    </p>
    </p>

    <table id="lista" border="1" style="text-align: center;">

    </table>

    <!-- Botão para acionar modal -->
<button type="button" class="btn btn-primary hidden" data-toggle="modal" data-target="#ModalLongoExemplo">
    Abrir modal de demonstração
  </button>
  
  <!-- Modal -->
  <div class="modal fade" id="ModalLongoExemplo" tabindex="-1" role="dialog" aria-labelledby="TituloModalLongoExemplo" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="TituloModalLongoExemplo">Título do modal</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <img src="" class="rounded mx-auto d-block recebeimg" width="100%" alt="...">
            <hr>
            <span class="mserie"></span><hr>
            <span class="mrepeticoes"></span><hr>
            <span class="mcarga"></span><hr>
            <span class="mdescanso"></span><hr>
            <span class="mmetodo"></span><hr>
            <iframe class="mvideo" height="500px"></iframe><hr>
            
        </div>
          
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          <!-- <button type="button" class="btn btn-primary">Salvar mudanças</button> -->
        </div>
      </div>
    </div>
  </div>

</body>
</html>

<script>
    var serie1 = [];

    var serie2 = [];

    var serie3 = [];

    let db = new Localbase('db');
    findAll();

    document.querySelector("#ativarAdd").addEventListener('click', function(){
        var escondida = document.querySelector("#escondida");
        if(escondida.style.display == 'none'){
            escondida.style.display = '';
            document.querySelector("#ativarAdd").value = "ocultar";
        }else{
            escondida.style.display = 'none';
            document.querySelector("#ativarAdd").value = "Add Exercício";
        }
    });

    document.querySelector("#addEx").addEventListener('click', function(){
        adicionarExercicio();
        setTimeout(function(){
            findAll();
        }, 500);
    });
    
    function adicionarExercicio(){
        try {
            db.collection("listaExercicios").add({
                "nome" : document.querySelector("#nomeEx").value,
                "serie" : document.querySelector("#serieEx").value,
                "repeticioes" : document.querySelector("#repeticoesEx").value,
                "carga" : document.querySelector("#cargaEx").value,
                "descanso" : document.querySelector("#descansoEx").value,
                "metodo" : document.querySelector("#metodoEx").value,
                "imagem" : document.querySelector("#imagemEx").value,
                "video" : document.querySelector("#videoEx").value,
                "tipo" : document.querySelector("input[name='tipoEx']:checked").value,
                "hidden" : parseInt(Math.random() * (1000000 - 1) + 1),
            });
        } catch (error) {
            alert("Falha ao salvar.");
        }
    }

    function findAll(){
        let tabela = "";
        db.collection("listaExercicios").get().then(dados => {    
            document.querySelector("#lista").innerHTML = "";
            let addlinha = `<thead><tr><th>Exercícios</th><th>Imagem</th><th>Deletar</th></tr></thead>`;
            dados.forEach(e=>{
                addlinha += `<tr><td style='display:none'>${e.hidden}</td><td>${e.nome}</td><td>${e.tipo}</td><td><button id='btndel'>x</button></td></tr>`;
            });

            let tbtarefas = document.querySelector("#lista"); 
            tbtarefas.innerHTML = addlinha; 
            
            let botaoDel = document.querySelectorAll('#btndel');
            botaoDel.forEach(e=>{
                e.addEventListener("click", function(){
                    // console.log(e.closest("tr").querySelector("td:nth-child(1)").textContent);
                    db.collection("listaExercicios").doc({hidden:parseInt(e.closest("tr").querySelector("td:nth-child(1)").textContent, 10)}).delete();
                });
            });
        });

    }
        
    function findAllObjects(){
        db.collection("listaExercicios").get().then(dados=>{
            try {
                dados.forEach(obj =>{
                    let objeto = new Object();
                    objeto.exercicio = obj.nome;
                    objeto.serie = obj.serie;
                    objeto.repeticoes = obj.repeticoes;
                    objeto.carga = obj.carga;
                    objeto.descanso = obj.descanso;
                    objeto.metodo = obj.metodo;
                    objeto.img = obj.img;
                    objeto.video = obj.video;
                    objeto.tipo = obj.tipo;
                    objeto.hidden = obj.hidden;
                    if(objeto.tipo == '0'){
                        serie1.push(objeto);
                    }else if(objeto.tipo == '1'){
                        serie2.push(objeto);
                    }else{
                        serie3.push(objeto);
                    }
                });
                
            } catch (error) {
                console.log("Falha ao carregar exercício.");
            }
        });
    }

    findAllObjects();
    montarTela();

    function montarTela(){
    setTimeout(function(){
        var tabela = document.querySelector("#treino_1");
        document.querySelector("#treino_1").innerHTML = "";
        var html = "<tr class='noactions'><td>id</td><td>Exercício</td><td class='hide'>Série</td><td class='hide'>Repetições</td><td class='hide'>Carga</td><td class='hide'>Descanso</td><td class='hide'>Método</td><td class='hide'>img</td><td class='hide'>vídeo</td></tr>";
    serie1.forEach((ele, i)=>{
        
        html += "<tr class='tpernas'>";
        html += "<td>"+(i+1);
            html += "</td><td>"+(ele.exercicio);
        html += "</td><td class='hide'>"+(ele.serie);
            html += "</td><td class='hide'>"+(ele.repetições);
                html += "</td><td class='hide'>"+(ele.carga);
        html += "</td><td class='hide'>"+(ele.descanso);
        html += "</td><td class='hide'>"+(ele.metodo);
            html += "</td><td class='hide'>"+(ele.img);
        html += "</td><td class='hide'>"+(ele.video);
        html += "</td></tr>";
    });
    

    serie2.forEach((ele, i)=>{
        html += "<tr class='tbiceps'>";
        html += "<td>"+(i+1);
        html += "</td><td>"+(ele.exercicio);
        html += "</td><td class='hide'>"+(ele.serie);
        html += "</td><td class='hide'>"+(ele.repetições);
        html += "</td><td class='hide'>"+(ele.carga);
        html += "</td><td class='hide'>"+(ele.descanso);
            html += "</td><td class='hide'>"+(ele.metodo);
        html += "</td><td class='hide'>"+(ele.img);
            html += "</td></tr>";
        });

    serie3.forEach((ele, i)=>{
        html += "<tr class='ttriceps'>";
            html += "<td>"+(i+1);
                html += "</td><td>"+(ele.exercicio);
                    html += "</td><td class='hide'>"+(ele.serie);
        html += "</td><td class='hide'>"+(ele.repetições);
        html += "</td><td class='hide'>"+(ele.carga);
        html += "</td><td class='hide'>"+(ele.descanso);
            html += "</td><td class='hide'>"+(ele.metodo);
        html += "</td><td class='hide'>"+(ele.img);
        html += `</td><td class='hide'>${(ele.video)}`;
            html += "</td></tr>";
        });
        
        tabela.innerHTML = html;
        alinharIndice();
    }, 1000);
    }
    function change(opcao){
        if(opcao.value == 1){
            document.querySelectorAll(".tpernas").forEach(ele=>{
                ele.style.display = "";
            });
            document.querySelectorAll(".tbiceps").forEach(ele=>{
                ele.style.display = "none";
            });
            document.querySelectorAll(".ttriceps").forEach(ele=>{
                ele.style.display = "none";
            });

        }else if(opcao.value == 2){
            document.querySelectorAll(".tpernas").forEach(ele=>{
                ele.style.display = "none";
            });
            document.querySelectorAll(".tbiceps").forEach(ele=>{
                ele.style.display = "";
            });
            document.querySelectorAll(".ttriceps").forEach(ele=>{
                ele.style.display = "none";
            });

        }else if(opcao.value == 3){
            document.querySelectorAll(".tpernas").forEach(ele=>{
                ele.style.display = "none";
            });
            document.querySelectorAll(".tbiceps").forEach(ele=>{
                ele.style.display = "none";
            });
            document.querySelectorAll(".ttriceps").forEach(ele=>{
                ele.style.display = "";
            });
            
        }else{
            document.querySelectorAll(".tpernas").forEach(ele=>{
                ele.style.display = "";
            });
            document.querySelectorAll(".tbiceps").forEach(ele=>{
                ele.style.display = "";
            });
            document.querySelectorAll(".ttriceps").forEach(ele=>{
                ele.style.display = "";
            });
        }

        alinharIndice();
    }

    setTimeout(function(){

    document.querySelectorAll("#treino_1 tr").forEach(ele=>{
        if(!ele.textContent.includes("idExercícioSérieRepetições")){
            ele.addEventListener("click", ()=>{
                if(ele.style.backgroundColor == "yellow"){
                ele.style.backgroundColor = "";
            }else{
                ele.style.backgroundColor = "yellow";
            }
            })
            ele.addEventListener("dblclick", ()=>{
            document.querySelector("button[data-target='#ModalLongoExemplo']").click();
            document.querySelector(".recebeimg").setAttribute("src", ele.querySelector("td:nth-child(8)").textContent); 
            document.querySelector("#TituloModalLongoExemplo").textContent = ele.querySelector("td:nth-child(2)").textContent;  
            document.querySelector(".mserie").textContent = "Série: " + ele.querySelector("td:nth-child(3)").textContent;  
            document.querySelector(".mrepeticoes").textContent = "Repetições: " +  ele.querySelector("td:nth-child(4)").textContent;  
            document.querySelector(".mcarga").textContent = "Carga: " +  ele.querySelector("td:nth-child(5)").textContent;    
            document.querySelector(".mdescanso").textContent = "Descanso: " +  ele.querySelector("td:nth-child(6)").textContent;  
            document.querySelector(".mmetodo").textContent = "Método: " +  ele.querySelector("td:nth-child(7)").textContent;  
            document.querySelector(".mvideo").src = ele.querySelector("td:nth-child(9)").textContent;  
        })
        }
    });

    document.querySelector("button.btn.btn-secondary").addEventListener("click",()=>{
        document.querySelector(".recebeimg").setAttribute("src", "");
    });

    var papeldeparede = [
        "https://w0.peakpx.com/wallpaper/772/564/HD-wallpaper-never-give-up-body-bodybuilding-bodybuilding-fitness-gethealthy-gym-healthylife-motivation-workout.jpg",
        "https://wallpaperaccess.com/full/7458375.jpg",
        "https://i.pinimg.com/550x/10/c7/05/10c7056eaf594808e458790540f1f028.jpg",
        "https://i.pinimg.com/736x/0b/e5/5f/0be55fa84182893bacd4bdd0113e1f5b.jpg",
        "https://w0.peakpx.com/wallpaper/328/370/HD-wallpaper-gym-goku.jpg"
    ];

    document.querySelector("body").style.backgroundImage = `URL(${papeldeparede[Math.floor(Math.random()*papeldeparede.length)]})`;
    document.querySelector("body").style.backgroundRepeat = "no-repeat";
    document.querySelector("body").style.backgroundSize = "cover";
    document.querySelector("body").style.backgroundPosition = "center";
    document.querySelector("body").style.backgroundAttachment = "fixed";

    document.querySelector(".opaco").style.backgroundColor = "rgba(255, 255, 255, 0.8)";
},1500);

function alinharIndice(){
    document.querySelectorAll("#treino_1 tbody tr:not(.noactions, [style*='display: none']) td:nth-child(1)").forEach((ele, i)=>{
            ele.textContent = i+1;
    });
}
// ------------


</script>
